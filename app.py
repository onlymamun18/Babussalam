import streamlit as st
import pandas as pd

# ржЧрзБржЧрж▓ рж╢рж┐ржЯ ржХрж╛ржирзЗржХрж╢ржи
SHEET_ID = '1TRbxG151RFzNdKbQ7KShWWV1MJHIVxSNdF-rSfLMde0'
url = f'https://docs.google.com/spreadsheets/d/{SHEET_ID}/export?format=csv'

# ржЕрзНржпрж╛ржк ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи
st.set_page_config(page_title="ржмрж╛ржмрзБрж╕ рж╕рж╛рж▓рж╛ржо ржЗрж╕рж▓рж╛ржорж┐ ржПржХрж╛ржбрзЗржорж┐", page_icon="ЁЯХМ", layout="wide")

# ржбрж┐ржЬрж╛ржЗржи ржЙржирзНржиржд ржХрж░рж╛рж░ ржЬржирзНржп CSS
st.markdown("""
    <style>
    .main { background-color: #f8f9fa; }
    .stButton>button { width: 100%; border-radius: 8px; background-color: #008080; color: white; height: 3em; }
    .info-box { background-color: white; padding: 20px; border-radius: 15px; box-shadow: 0px 4px 10px rgba(0,0,0,0.1); border-left: 5px solid #008080; }
    h1 { color: #008080; text-align: center; }
    </style>
    """, unsafe_allow_html=True)

# ржбрж╛ржЯрж╛ рж▓рзЛржб ржХрж░рж╛рж░ ржлрж╛ржВрж╢ржи
@st.cache_data(ttl=30)
def load_data():
    try:
        data = pd.read_csv(url)
        data.columns = data.columns.str.strip() # ржХрж▓рж╛ржорзЗрж░ ржмрж╛рзЬрждрж┐ рж╕рзНржкрзЗрж╕ ржХрж╛ржЯржмрзЗ
        return data
    except:
        return None

df = load_data()

# рж╕рж╛ржЗржбржмрж╛рж░ ржорзЗржирзБ ржбрж┐ржЬрж╛ржЗржи
with st.sidebar:
    st.markdown("<h2 style='text-align: center; color: #008080;'>ржорзЗржирзБржмрж╛рж░</h2>", unsafe_allow_html=True)
    choice = st.radio("ржкрзЗржЬ рж╕рж┐рж▓рзЗржХрзНржЯ ржХрж░рзБржи:", ["ЁЯПа ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржб", "ЁЯФН ржЖржЗржбрж┐ рж╕рж╛рж░рзНржЪ", "ЁЯУЭ рж╣рж╛ржЬрж┐рж░рж╛ ржУ рж░рзЗржЬрж╛рж▓рзНржЯ", "ЁЯУв ржирзЛржЯрж┐рж╢ ржмрзЛрж░рзНржб", "ЁЯУЪ ржХрж┐рждрж╛ржмржЦрж╛ржирж╛"])

# рзз. ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржб
if choice == "ЁЯПа ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржб":
    st.markdown("<h1>ЁЯХМ ржмрж╛ржмрзБрж╕ рж╕рж╛рж▓рж╛ржо ржЗрж╕рж▓рж╛ржорж┐ ржПржХрж╛ржбрзЗржорж┐</h1>", unsafe_allow_html=True)
    st.image("https://images.unsplash.com/photo-1590076214667-c0f3c7e0f2b2?q=80&w=1000", use_container_width=True) # ржПржХржЯрж┐ рж╕рзБржирзНржжрж░ ржХржнрж╛рж░ ржЫржмрж┐
    
    col1, col2, col3 = st.columns(3)
    col1.metric("ржорзЛржЯ ржЫрж╛рждрзНрж░", "рззрзирзж")
    col2.metric("рж╢рж┐ржХрзНрж╖ржХ", "рззрзж")
    col3.metric("рж╕рж╛ржлрж▓рзНржп", "рззрзжрзж%")

# рзи. ржЖржЗржбрж┐ ржжрж┐рзЯрзЗ рж╕рж╛рж░рзНржЪ (ржЖржкржирж╛рж░ ржорзВрж▓ ржЪрж╛рж╣рж┐ржжрж╛)
elif choice == "ЁЯФН ржЖржЗржбрж┐ рж╕рж╛рж░рзНржЪ":
    st.header("ЁЯФН ржЫрж╛рждрзНрж░/рж╢рж┐ржХрзНрж╖ржХрзЗрж░ рждржерзНржп ржЕржирзБрж╕ржирзНржзрж╛ржи")
    search_id = st.text_input("ржЖржЗржбрж┐ ржиржорзНржмрж░ржЯрж┐ ржЯрж╛ржЗржк ржХрж░рзБржи:", placeholder="ржпрзЗржоржи: 101")
    
    if st.button("рждржерзНржп ржжрзЗржЦрзБржи"):
        if df is not None and search_id:
            # ID ржХрж▓рж╛ржоржЯрж┐ ржЦрзБржБржЬрзЗ ржмрзЗрж░ ржХрж░рж╛ (ржмрзЬ/ржЫрзЛржЯ рж╣рж╛рждрзЗрж░ ржЕржХрзНрж╖рж░ ржпрж╛ржЗ рж╣рзЛржХ)
            id_col = [col for col in df.columns if col.lower() == 'id']
            if id_col:
                result = df[df[id_col[0]].astype(str) == str(search_id)]
                if not result.empty:
                    res = result.iloc[0]
                    st.success("ржЖрж▓рж╣рж╛ржоржжрзБрж▓рж┐рж▓рзНрж▓рж╛рж╣! рждржерзНржп ржкрж╛ржУрзЯрж╛ ржЧрзЗржЫрзЗред")
                    
                    # рж╕рзБржирзНржжрж░ ржмржХрзНрж╕рзЗ рждржерзНржп ржкрзНрж░ржжрж░рзНрж╢ржи
                    st.markdown(f"""
                    <div class="info-box">
                        <h2 style="color: #008080;">ЁЯСд ржирж╛ржо: {res.get('Name', 'N/A')}</h2>
                        <hr>
                        <p><b>ЁЯС┤ ржкрж┐рждрж╛рж░ ржирж╛ржо:</b> {res.get('Father', 'N/A')}</p>
                        <p><b>ЁЯС╡ ржорж╛рждрж╛рж░ ржирж╛ржо:</b> {res.get('Mother', 'N/A')}</p>
                        <p><b>ЁЯУЮ ржорзЛржмрж╛ржЗрж▓:</b> {res.get('Mobile', 'N/A')}</p>
                        <p><b>ЁЯУН ржарж┐ржХрж╛ржирж╛:</b> {res.get('Address', 'N/A')}</p>
                    </div>
                    """, unsafe_allow_html=True)
                else:
                    st.error("ржжрзБржГржЦрж┐ржд, ржПржЗ ржЖржЗржбрж┐ ржжрж┐рзЯрзЗ ржХрзЛржирзЛ рждржерзНржп ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐ред")
            else:
                st.error("ржЧрзБржЧрж▓ рж╢рж┐ржЯрзЗ 'ID' ржХрж▓рж╛ржоржЯрж┐ ржЦрзБржБржЬрзЗ ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐ред")
        else:
            st.warning("ржЖржЗржбрж┐ ржиржорзНржмрж░ ржжрж┐рзЯрзЗ ржмрж╛ржЯржирзЗ ржХрзНрж▓рж┐ржХ ржХрж░рзБржиред")

# рзй. рж╣рж╛ржЬрж┐рж░рж╛ ржУ рж░рзЗржЬрж╛рж▓рзНржЯ (ржиржорзБржирж╛ ржлрж┐ржЪрж╛рж░)
elif choice == "ЁЯУЭ рж╣рж╛ржЬрж┐рж░рж╛ ржУ рж░рзЗржЬрж╛рж▓рзНржЯ":
    st.header("ЁЯУЭ рж╣рж╛ржЬрж┐рж░рж╛ ржУ рж░рзЗржЬрж╛рж▓рзНржЯ рж╕рзЗржХрж╢ржи")
    st.info("ржПржЗ рж╕рзЗржХрж╢ржирзЗрж░ ржбрж╛ржЯрж╛ ржПржЦржирзЛ ржЧрзБржЧрж▓ рж╢рж┐ржЯрзЗрж░ рж╕рж╛ржерзЗ ржпрзБржХрзНржд ржХрж░рж╛ рж╣рзЯржирж┐ред ржЖржкржирж┐ ржЪрж╛ржЗрж▓рзЗ ржкрж░рзЗ ржЖрж▓рж╛ржжрж╛ рж╢рж┐ржЯ ржжрж┐рзЯрзЗ ржПржЯрж┐ржУ рж▓рж╛ржЗржн ржХрж░рж╛ ржпрж╛ржмрзЗред")
    st.date_input("рждрж╛рж░рж┐ржЦ")
    st.selectbox("ржкрж░рзАржХрзНрж╖рж╛рж░ ржирж╛ржо", ["ржорж╛рж╕рж┐ржХ", "ржмрж╛рж░рзНрж╖рж┐ржХ"])

# рзк. ржирзЛржЯрж┐рж╢ ржУ ржХрж┐рждрж╛ржмржЦрж╛ржирж╛ (ржЖржЧрзЗрж░ ржбрж┐ржЬрж╛ржЗржи)
elif choice == "ЁЯУв ржирзЛржЯрж┐рж╢ ржмрзЛрж░рзНржб" or choice == "ЁЯУЪ ржХрж┐рждрж╛ржмржЦрж╛ржирж╛":
    st.header(choice)
    st.write("ржПржЗ ржкрзЗржЬржЯрж┐рж░ ржХрж╛ржЬ ржкрзНрж░ржХрзНрж░рж┐рзЯрж╛ржзрзАржи...")
    st.info("ржЖржкржирж┐ ржПржЦрж╛ржирзЗ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржирзЛржЯрж┐рж╢ ржмрж╛ ржХрж┐рждрж╛ржмрзЗрж░ ржкрж┐ржбрж┐ржПржл рж▓рж┐ржЩрзНржХ ржпрзЛржЧ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржиред")рж░ рж▓рзЛржб ржирж╛ рж╣рзЯ
        return pd.read_csv(url)
    except Exception as e:
        st.error("ржбрж╛ржЯрж╛ржмрзЗрж╕ ржХрж╛ржирзЗржХрзНржЯ ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣ржЪрзНржЫрзЗред ржжрзЯрж╛ ржХрж░рзЗ ржЗржирзНржЯрж╛рж░ржирзЗржЯ ржЪрзЗржХ ржХрж░рзБржиред")
        return None

df = load_data()

# рж╕рж╛рж░рзНржЪ ржмржХрзНрж╕
st.subheader("ЁЯФН ржЖржЗржбрж┐ ржжрж┐рзЯрзЗ рждржерзНржп ржЦрзБржБржЬрзБржи")
search_id = st.text_input("ржПржЦрж╛ржирзЗ ржЫрж╛рждрзНрж░ ржмрж╛ рж╢рж┐ржХрзНрж╖ржХрзЗрж░ ржЖржЗржбрж┐ ржиржорзНржмрж░ржЯрж┐ рж▓рж┐ржЦрзБржи:", placeholder="ржпрзЗржоржи: 101")

if st.button("рж╕рж╛рж░рзНржЪ ржХрж░рзБржи"):
    if df is not None:
        if search_id:
            # ржЖржЗржбрж┐ ржжрж┐рзЯрзЗ ржбрж╛ржЯрж╛ ржЦрзЛржБржЬрж╛ (ржЖржЗржбрж┐ ржХрж▓рж╛ржоржЯрж┐ String ржП ржХржиржнрж╛рж░рзНржЯ ржХрж░рзЗ ржЪрзЗржХ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ)
            result = df[df['ID'].astype(str) == str(search_id)]
            
            if not result.empty:
                st.success(f"ржЖрж▓рж╣рж╛ржоржжрзБрж▓рж┐рж▓рзНрж▓рж╛рж╣! ржЖржЗржбрж┐ {search_id}-ржПрж░ рждржерзНржп ржкрж╛ржУрзЯрж╛ ржЧрзЗржЫрзЗред")
                res = result.iloc[0] # ржкрзНрж░ржержо рж░рзЗржЬрж╛рж▓рзНржЯржЯрж┐ ржирзЗржУрзЯрж╛
                
                # рж╕рзБржирзНржжрж░ ржХрж░рзЗ ржмржХрзНрж╕рзЗ рждржерзНржп ржжрзЗржЦрж╛ржирзЛ
                with st.container():
                    st.markdown(f"""
                    <div style="background-color: #ffffff; padding: 20px; border-radius: 10px; border: 1px solid #ddd; box-shadow: 2px 2px 5px rgba(0,0,0,0.1);">
                        <h3 style="color: #008080; margin-top: 0;">ЁЯСд {res['Name']}</h3>
                        <hr>
                        <p><b>ржкрж┐рждрж╛рж░ ржирж╛ржо:</b> {res['Father']}</p>
                        <p><b>ржорж╛рждрж╛рж░ ржирж╛ржо:</b> {res['Mother']}</p>
                        <p><b>ржорзЛржмрж╛ржЗрж▓:</b> {res['Mobile']}</p>
                        <p><b>ржарж┐ржХрж╛ржирж╛:</b> {res['Address']}</p>
                    </div>
                    """, unsafe_allow_html=True)
            else:
                st.error("ржжрзБржГржЦрж┐ржд, ржПржЗ ржЖржЗржбрж┐ ржжрж┐рзЯрзЗ ржХрзЛржирзЛ рждржерзНржп ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ ржирзЗржЗред")
        else:
            st.warning("ржжрзЯрж╛ ржХрж░рзЗ ржПржХржЯрж┐ ржЖржЗржбрж┐ ржиржорзНржмрж░ ржЯрж╛ржЗржк ржХрж░рзБржиред")
    else:
        st.warning("ржбрж╛ржЯрж╛ржмрзЗрж╕ рж▓рзЛржб рж╣рждрзЗ ржкрж╛рж░ржЫрзЗ ржирж╛ред")

st.write("---")
st.caption("ржЖржкржирж╛рж░ ржЧрзБржЧрж▓ рж╢рж┐ржЯрзЗ ржирждрзБржи рждржерзНржп ржпрзЛржЧ ржХрж░рж▓рзЗ рждрж╛ ржПржЦрж╛ржирзЗ ржЕржЯрзЛржорзЗржЯрж┐ржХ ржЖржкржбрзЗржЯ рж╣рзЯрзЗ ржпрж╛ржмрзЗред")
